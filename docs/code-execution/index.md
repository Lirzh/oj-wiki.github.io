# 代码执行

在用户提交代码之后，需要在一个安全，受信任，一致的环境中编译，并执行用户的代码。代码执行需要满足

- 环境一致：避免运行环境对结果的影响。理想情况下，运行硬件和软件需要保持一致。
- 环境隔离：用户程序可能包含恶意代码，需要保证不会修改或者破坏环境，窃取机密信息
- 资源限制：用户程序需要在题目给定的 CPU ，内存等限制下运行
- 资源统计：用户程序运行结束后，需要统计使用的系统资源
- 文件收集：需要在执行前准备输入文件，并在执行后收集产生的输出文件

文档提供了在 Linux 下常用的资源隔离技术，以及各个编译器的参数和开源实现。

## 环境一致

在分布式系统中，运行环境一致性可以通过容器镜像或者虚拟机镜像实现。或者使用可以可靠复现环境的包管理（例如 nix ）系统。

## 环境隔离

- 网络访问限制
- 文件系统访问限制
- 特权操作限制

## 资源限制

运行环境通常需要限制以下资源

- 时间限制
  - CPU 时间
  - 真实 （Wall-clock）时间
- 内存限制
  - 最大内存使用
  - 最大虚拟内存
  - 最大栈空间使用
- 输出限制
- 文件大小限制
- 进程数量限制

## 资源统计

运行结束以后需要统计使用的计算资源

- CPU 时间
- 真实（Wall-clock）时间
- 最大内存使用量

## 文件收集

运行结束时，可能需要收集产生的结果文件。如编译之后的可执行文件，或者运行时写入的答案文件。需要确认

- 文件存在
- 文件大小符合限制
- 文件是一个普通文件（不是文件夹，设备，管道等）
